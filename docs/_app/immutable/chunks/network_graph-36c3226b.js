import{S as x,i as $,s as ee,e as N,c as R,a as j,d as c,b as F,g as I,k as T,t as y,m as G,h as E,j as C,G as w,M as te,n as W,N as ae}from"./index-ef7e113d.js";const le="https://query.wikidata.org/sparql",ie="https://dancing-digital.wikibase.cloud/query/sparql";async function re(s,e){console.log(s);let t=new FormData;t.append("query",s);let r=await fetch(e==="wikidata"?le:ie,{method:"post",headers:{Accept:"application/sparql-results+json"},body:new URLSearchParams(t)});return r.ok?(await r.json()).results.bindings:[]}function D(s,e){return e[s].value.split("/")[4]}function ne(s,e,t){let l=e.map(i=>i.split(" ").map(a=>`wdt:${a}`).join(", ")).join(", "),r=s.map(i=>`wd:${i}`).join(" "),o="";return t==="ddc"&&(o+=`
    PREFIX wd: <https://dancing-digital.wikibase.cloud/entity/>
    PREFIX wdt: <https://dancing-digital.wikibase.cloud/prop/direct/>`),o+=`
  SELECT DISTINCT ?prop ?propLabel ?selectedItem ?selectedItemLabel ?itemF ?itemFLabel ?itemR ?itemRLabel WHERE {
    VALUES ?selectedItem {
      ${r}
    }
    { ?selectedItem ?prop_ ?itemF. }
    UNION
    { ?itemR ?prop_ ?selectedItem. }
    ?prop wikibase:directClaim ?prop_.
    FILTER(?prop_ IN(${l}))
    SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
  }
  LIMIT 1000
  `,o}async function K(s,e,t){let l=ne(s,e,t);return{data:await re(l,t),query:l}}function Z(s,e=200){let t=new Set,l=[],r=[],o={},i=se(s),a=oe(i,e);return s.filter(n=>{let d;return n.itemF!=null?d=D("itemF",n):d=D("itemR",n),a.has(d)}).forEach(n=>{let d,u,h,g,b=D("prop",n),v=n.propLabel.value;if(n.itemF?(d=D("selectedItem",n),u=n.selectedItemLabel.value,h=D("itemF",n),g=n.itemFLabel.value):(d=D("itemR",n),u=n.itemRLabel.value,h=D("selectedItem",n),g=n.selectedItemLabel.value),!t.has(d)){t.add(d);let S={id:d,label:u};l.push(S),o[d]=u}if(!t.has(h)){t.add(h);let S={id:h,label:g};l.push(S),o[h]=g}let L=`${d} ${b} ${h}`;t.has(L)||(t.add(L),r.push({from:d,to:h,propertyId:b,label:v,fromLabel:o[d],toLabel:o[h]}))}),{nodes:l,edges:r}}function se(s){let e={};return s.forEach(t=>{let l=D("selectedItem",t);if(e[l]==null&&(e[l]={parent:null,kids:[]}),t.itemF!=null){let r=D("itemF",t);e[r]==null&&(e[r]={parent:l,kids:[]}),e[l].kids.push(r)}if(t.itemR!=null){let r=D("itemR",t);e[r]==null&&(e[r]={parent:l,kids:[]}),e[l].kids.push(r)}}),e}function oe(s,e){let t=new Set;for(let[l,r]of Object.entries(s))r.parent==null&&t.add(l),r.kids.forEach((o,i)=>{i<e&&t.add(o)});return t}async function he(s,e,t,l,r="wikidata"){let o;for(;t>0;){let i=await K(s,e,r);o=Z(i.data),o.query=i.query,o.nodes=o.nodes.filter(a=>!l.includes(a.id)),o.edges=o.edges.filter(a=>!l.includes(a.to)&&!l.includes(a.from)),s=o.nodes.map(a=>a.id),t=t-1}return o}async function de(s,e,t){let l=await K([s],e,t),r=Z(l.data);return r.query=l.query,r}function V(s,e,t){const l=s.slice();return l[20]=e[t],l}function Y(s){let e;return{c(){e=N("div"),this.h()},l(t){e=R(t,"DIV",{class:!0}),j(e).forEach(c),this.h()},h(){F(e,"class","lds-dual-ring svelte-dt5x0l")},m(t,l){I(t,e,l)},d(t){t&&c(e)}}}function B(s){let e,t,l,r,o,i=s[2].id&&H(s);return{c(){i&&i.c(),e=T(),t=y(s[3]),l=y(" records, "),r=y(s[4]),o=y(" relationships")},l(a){i&&i.l(a),e=G(a),t=E(a,s[3]),l=E(a," records, "),r=E(a,s[4]),o=E(a," relationships")},m(a,n){i&&i.m(a,n),I(a,e,n),I(a,t,n),I(a,l,n),I(a,r,n),I(a,o,n)},p(a,n){a[2].id?i?i.p(a,n):(i=H(a),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null),n&8&&C(t,a[3]),n&16&&C(r,a[4])},d(a){i&&i.d(a),a&&c(e),a&&c(t),a&&c(l),a&&c(r),a&&c(o)}}}function H(s){let e=s[2].label+"",t,l,r=s[2].id+"",o,i;return{c(){t=y(e),l=y(" ("),o=y(r),i=y("):")},l(a){t=E(a,e),l=E(a," ("),o=E(a,r),i=E(a,"):")},m(a,n){I(a,t,n),I(a,l,n),I(a,o,n),I(a,i,n)},p(a,n){n&4&&e!==(e=a[2].label+"")&&C(t,e),n&4&&r!==(r=a[2].id+"")&&C(o,r)},d(a){a&&c(t),a&&c(l),a&&c(o),a&&c(i)}}}function X(s){let e,t=s[0].edges,l=[];for(let r=0;r<t.length;r+=1)l[r]=J(V(s,t,r));return{c(){e=N("table");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=R(r,"TABLE",{class:!0});var o=j(e);for(let i=0;i<l.length;i+=1)l[i].l(o);o.forEach(c),this.h()},h(){F(e,"class","table svelte-dt5x0l")},m(r,o){I(r,e,o);for(let i=0;i<l.length;i+=1)l[i].m(e,null)},p(r,o){if(o&33){t=r[0].edges;let i;for(i=0;i<t.length;i+=1){const a=V(r,t,i);l[i]?l[i].p(a,o):(l[i]=J(a),l[i].c(),l[i].m(e,null))}for(;i<l.length;i+=1)l[i].d(1);l.length=t.length}},d(r){r&&c(e),te(l,r)}}}function J(s){let e,t,l,r=s[20].fromLabel+"",o,i,a,n,d=s[20].label+"",u,h,g,b,v=s[20].toLabel+"",L,S,A;return{c(){e=N("tr"),t=N("td"),l=N("a"),o=y(r),a=T(),n=N("td"),u=y(d),h=T(),g=N("td"),b=N("a"),L=y(v),A=T(),this.h()},l(_){e=R(_,"TR",{});var p=j(e);t=R(p,"TD",{});var z=j(t);l=R(z,"A",{href:!0});var O=j(l);o=E(O,r),O.forEach(c),z.forEach(c),a=G(p),n=R(p,"TD",{});var U=j(n);u=E(U,d),U.forEach(c),h=G(p),g=R(p,"TD",{});var f=j(g);b=R(f,"A",{href:!0});var k=j(b);L=E(k,v),k.forEach(c),f.forEach(c),A=G(p),p.forEach(c),this.h()},h(){F(l,"href",i=s[5](s[20].from)),F(b,"href",S=s[5](s[20].to))},m(_,p){I(_,e,p),w(e,t),w(t,l),w(l,o),w(e,a),w(e,n),w(n,u),w(e,h),w(e,g),w(g,b),w(b,L),w(e,A)},p(_,p){p&1&&r!==(r=_[20].fromLabel+"")&&C(o,r),p&1&&i!==(i=_[5](_[20].from))&&F(l,"href",i),p&1&&d!==(d=_[20].label+"")&&C(u,d),p&1&&v!==(v=_[20].toLabel+"")&&C(L,v),p&1&&S!==(S=_[5](_[20].to))&&F(b,"href",S)},d(_){_&&c(e)}}}function fe(s){let e,t,l,r,o,i=s[1]&&Y(),a=s[0].nodes&&B(s),n=s[0].edges&&X(s);return{c(){e=N("main"),i&&i.c(),t=T(),a&&a.c(),l=T(),r=N("div"),o=T(),n&&n.c(),this.h()},l(d){e=R(d,"MAIN",{class:!0});var u=j(e);i&&i.l(u),t=G(u),a&&a.l(u),l=G(u),r=R(u,"DIV",{id:!0,class:!0}),j(r).forEach(c),o=G(u),n&&n.l(u),u.forEach(c),this.h()},h(){F(r,"id","mynetwork"),F(r,"class","svelte-dt5x0l"),F(e,"class","svelte-dt5x0l")},m(d,u){I(d,e,u),i&&i.m(e,null),w(e,t),a&&a.m(e,null),w(e,l),w(e,r),w(e,o),n&&n.m(e,null)},p(d,[u]){d[1]?i||(i=Y(),i.c(),i.m(e,t)):i&&(i.d(1),i=null),d[0].nodes?a?a.p(d,u):(a=B(d),a.c(),a.m(e,l)):a&&(a.d(1),a=null),d[0].edges?n?n.p(d,u):(n=X(d),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:W,o:W,d(d){d&&c(e),i&&i.d(),a&&a.d(),n&&n.d()}}}function ue(s,e,t){let{networkData:l}=e,{graphItem:r}=e,{properties:o}=e,{resetGraphStatus:i}=e,{loading:a}=e,{newSearchStatus:n}=e,{targetWiki:d="wikidata"}=e,{clickToLoadMoreNodes:u=!0}=e,h={},g={},b={},v=0,L=0,S=0;const A=ae();function _(f){let k=d=="wikidata"?"https://www.wikidata.org":"https://dancing-digital.wikibase.cloud";return k+="/wiki/",k+=d=="wikidata"?f:"Item:"+f,k}function p(){h={},g={},t(11,b={}),t(3,v=0)}function z(f){if(!f.nodes)return;let k="rgb(255,168,7)";t(1,a=!0);let q=[];f.nodes.forEach(m=>{m.id===r.id&&(m.color={background:k}),q.push(m)}),h=new vis.DataSet(q),g=new vis.DataSet(f.edges),h.length==0&&h.add({id:r.id,label:r.label,color:{background:k}});var P=document.getElementById("mynetwork"),M={nodes:h,edges:g},Q={layout:{improvedLayout:!1},edges:{arrows:{to:{enabled:!0,type:"arrow",scaleFactor:.5}}},physics:{barnesHut:{gravitationalConstant:-3e3,damping:1,avoidOverlap:.3}},interaction:{hover:u}};t(11,b=new vis.Network(P,M,Q)),U(b)}async function O(f){if(!u)return;let k=f.nodes[0],q=await de(k,o,d),P=!1;t(6,n=!1),A("changeSearchStatus",n);let M=new Set(l.nodes.map(m=>m.id)),Q=new Set(l.edges.map(m=>`${m.from} ${m.property_id} ${m.to}`));return q.nodes.forEach(m=>{M.has(m.id)||(h.add(m),t(3,v+=1),t(0,l.nodes=[...l.nodes,m],l),P=!0)}),q.edges.forEach(m=>{Q.has(`${m.from} ${m.property_id} ${m.to}`)||(g.add(m),t(0,l.edges=[...l.edges,m],l),P=!0)}),P}function U(f){f.on("doubleClick",async function(k){t(1,a=!0),await O(k)||t(1,a=!1)}),f.on("startStabilizing",function(){t(1,a=!1)}),f.on("stabilizationProgress",function(){t(1,a=!0)}),f.on("stabilizationIterationsDone",function(){t(1,a=!1)}),f.on("stabilized",function(){t(1,a=!1)}),f.on("afterDrawing",function(){a&&(S+=1,S>35&&(S=0,t(1,a=!1)))})}return s.$$set=f=>{"networkData"in f&&t(0,l=f.networkData),"graphItem"in f&&t(2,r=f.graphItem),"properties"in f&&t(7,o=f.properties),"resetGraphStatus"in f&&t(8,i=f.resetGraphStatus),"loading"in f&&t(1,a=f.loading),"newSearchStatus"in f&&t(6,n=f.newSearchStatus),"targetWiki"in f&&t(9,d=f.targetWiki),"clickToLoadMoreNodes"in f&&t(10,u=f.clickToLoadMoreNodes)},s.$$.update=()=>{s.$$.dirty&65&&n&&(p(),z(l),t(3,v=l.nodes?l.nodes.length:0),t(4,L=l.edges?l.edges.length:0)),s.$$.dirty&2304&&i&&typeof b.destroy=="function"&&(b.destroy(),p())},[l,a,r,v,L,_,n,o,i,d,u,b]}class me extends x{constructor(e){super(),$(this,e,ue,fe,ee,{networkData:0,graphItem:2,properties:7,resetGraphStatus:8,loading:1,newSearchStatus:6,targetWiki:9,clickToLoadMoreNodes:10})}}export{me as N,he as g};
